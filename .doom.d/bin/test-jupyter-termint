#!/Users/vwh7mb/.emacs.d/bin/doomscript

;; test-jupyter-termint: Test jupyter-termint functionality with proper Doom initialization

(defcli! test-jupyter-termint ()
  "Test jupyter-termint setup and function availability with full Doom initialization."
  
  ;; Initialize Doom properly
  (doom-modules-initialize)
  (doom-initialize t)
  (doom-startup)
  
  (message "=== DOOM-BASED JUPYTER-TERMINT TEST ===")
  
  ;; Load jupyter-termint
  (condition-case err
      (progn
        (require 'jupyter-termint)
        (message "✓ jupyter-termint loaded successfully"))
    (error 
     (message "✗ Failed to load jupyter-termint: %s" err)
     (cl-return)))
  
  ;; Run setup
  (condition-case err
      (progn
        (jupyter-termint-setup)
        (message "✓ jupyter-termint-setup completed"))
    (error 
     (message "✗ jupyter-termint-setup failed: %s" err)))
  
  ;; Check function availability
  (message "\nFunction availability:")
  (let ((funcs '(termint-jupyter-python-start 
                termint-jupyter-r-start 
                termint-jupyter-stata-start
                termint-jupyter-python-send-string
                termint-jupyter-r-send-string
                termint-jupyter-stata-send-string)))
    (dolist (func funcs)
      (if (fboundp func)
          (message "  ✓ %s: available" func)
        (message "  ✗ %s: missing" func))))
  
  ;; Check termint configuration
  (message "\nTermint configuration:")
  (message "  Backend: %s" (if (boundp 'termint-backend) termint-backend "UNSET"))
  (message "  vterm available: %s" (featurep 'vterm))
  
  ;; Check jupyter paths
  (message "\nJupyter paths:")
  (let ((jupyter-paths (list
                        (executable-find "jupyter")
                        ".pixi/envs/default/bin/jupyter"
                        "/Users/vwh7mb/projects/wander2/.pixi/envs/default/bin/jupyter")))
    (dolist (path jupyter-paths)
      (if path
          (message "  %s: %s" 
                   path 
                   (if (file-executable-p path) "✓ executable" "✗ not executable"))
        (message "  nil path"))))
  
  ;; Show current buffers
  (message "\nCurrent buffers: %s" (mapcar #'buffer-name (buffer-list)))
  
  (message "=== END DOOM TEST ===")
  (message "Note: Buffer creation tests require GUI mode due to vterm limitations."))

;; Run the test
(run! "test-jupyter-termint")
(provide 'test-jupyter-termint)